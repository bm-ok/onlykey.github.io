

<!DOCTYPE HTML>
<html>
<head>
<title>JavaScript Test AES GCM</title>
</head>
<body>
<h1>JavaScript Test AES GCM</h1>
<script type="text/javascript"src=./rand.js></script>
<script type="text/javascript"src=./uint64.js></script>
<script type="text/javascript"src=./aes.js></script>
<script type="text/javascript"src=./big.js></script>
<script type="text/javascript"src=./gcm.js></script>
<script type="text/javascript"src=./hash256.js></script>
<script type="text/javascript"src=./hash384.js></script>
<script type="text/javascript"src=./hash512.js></script>
<script type="text/javascript"src=./sha3.js></script>
<script type="text/javascript"src=./ctx.js></script>

<script>

// Test NewHope Simple
// See https://eprint.iacr.org/2016/1157 (Alkim, Ducas, Popplemann and Schwabe)

	var ctx = new CTX();

	var bytestostring = function(b) {
    var s = "";
    var len = b.length;
    var ch;

    for (var i = 0; i < len; i++) {
        ch = b[i];
        s += ((ch >>> 4) & 15).toString(16);
        s += (ch & 15).toString(16);
    }
    return s;
}

var stringtobytes = function(s) {
    var b = [];
    for (var i = 0; i < s.length; i++)
        b.push(s.charCodeAt(i));
    return b;
}

var hextobytes = function(value_hex) {
    // "use strict";
    var len, byte_value, i;

    len = value_hex.length;
    byte_value = [];

    for (i = 0; i < len; i += 2) {
        byte_value[(i / 2)] = parseInt(value_hex.substr(i, 2), 16);
    }
    return byte_value;
};

var AES_ENCRYPT = function(mode, K, M) {
    /* Input is from an octet string M, output is to an octet string C */
    /* Input is padded as necessary to make up a full final block */
    var a = new ctx.AES();
    var fin;
    var i, j, ipt, opt;
    var buff = [];
    /*var clen=16+(Math.floor(M.length/16))*16;*/

    var C = [];
    var padlen;

    a.init(mode, K.length, K, null);

    ipt = opt = 0;
    fin = false;
    for (;;) {
        for (i = 0; i < 16; i++) {
            if (ipt < M.length) buff[i] = M[ipt++];
            else {
                fin = true;
                break;
            }
        }
        if (fin) break;
        a.encrypt(buff);
        for (i = 0; i < 16; i++)
            C[opt++] = buff[i];
    }

    /* last block, filled up to i-th index */

    padlen = 16 - i;
    for (j = i; j < 16; j++) buff[j] = padlen;
    a.encrypt(buff);
    for (i = 0; i < 16; i++)
        C[opt++] = buff[i];
    a.end();
    return C;
};


var KEY = "edfdb257cb37cdf182c5455b0c0efebb";

console.log("Encryption Key: ",KEY);

PLAINTEXT = "1695fe475421cace3557daca01f445ff";

console.log("Plaintext: ",PLAINTEXT);

var Cout = AES_ENCRYPT(ctx.AES.ECB,hextobytes(KEY),hextobytes(PLAINTEXT));

console.log("Ciphertext: ",bytestostring(Cout));


</script>
</body>
</html>
